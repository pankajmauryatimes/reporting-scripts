MERGE INTO rpc_data_for_live_update AS rpc USING (select mobile_no,max(rpc_date) as rpc_date,source_flag from (select case when substr(mobile_no,1,2) = '91' then '+91-'||substr(mobile_no,3) else mobile_no end as mobile_no, rpc_date, source_flag from  rpc_data_for_live_update_stage where source_flag= 'RPC')t group by mobile_no,source_flag ) AS rpc_stage ON (rpc.mobile_no = rpc_stage.mobile_no) WHEN MATCHED THEN UPDATE SET rpc.rpc_date = rpc_stage.rpc_date, rpc.source_flag = rpc_stage.source_flag ,rpc.UPDATED_DATE = current date WHEN NOT MATCHED THEN INSERT  (rpc.mobile_no,rpc.rpc_date,rpc.source_flag,rpc.updated_date) VALUES(rpc_stage.mobile_no,rpc_stage.rpc_date,rpc_stage.source_flag,current date)

export to /home/datareq/generic_etl/wip/rpc_data_updates.txt of del modified by coldel, datesiso select 'update user u set IS_MOBILE_VERIFIED=''Y'' where tel_other ='''||MOBILE_NO ||''' and AGENT = ''I'' and IS_MOBILE_VERIFIED=''N'''  from rpc_data_for_live_update where updated_date = current date and SOURCE_FLAG = 'RPC' with ur

export to /home/datareq/generic_etl/wip/rpc_data_cand_mobile_verification_track.txt of del modified by coldel, datesiso select 'insert into cand_mobile_verification_track (MOB_NO,MODE,STATUS,TYPE,CREATED_DATE,MOB_ALREADY_EXIST) values ('''||rpc.MOBILE_NO ||''',''rpc'',''y'',''RPC'','''|| char(rpc.updated_date,ISO)||' 00:00:00.00'',''Y'')' from rpc_data_for_live_update rpc where exists (select 1 from  user u where rpc.MOBILE_NO = u.TEL_OTHER)  and rpc.updated_date between current date -1 day and current date and rpc.SOURCE_FLAG = 'RPC' with ur

